description: |
  Test installing a helm chart on a cluster.
usage:
  version: 2.1

  orbs:
    aws-eks: circleci/aws-eks@<<pipeline.parameters.dev-orb-version>>

  workflows:
    deployment:
      jobs:
        - aws-eks/create-cluster:
            cluster-name: my-eks-helm-demo
        - aws-eks/install-helm-chart:
            cluster-name: my-eks-helm-demo
            helm-version: "v3.7.1"
            chart: stable/grafana
            release-name: grafana-release
            requires:
              - aws-eks/create-cluster
        - aws-eks/delete-helm-release:
            cluster-name: my-eks-helm-demo
            release-name: grafana-release
            requires:
              - aws-eks/install-helm-chart
        - aws-eks/delete-cluster:
            cluster-name: my-eks-helm-demo
            requires:
              - aws-eks/delete-helm-release
